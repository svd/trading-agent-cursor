---
description: Правила для выполнения домашнего задания - скрининг инструментов, анализ уровней, определение предпосылок и формирование торговых сценариев
alwaysApply: false
---

# Домашнее задание - Workflow подготовки к торговой сессии

## Цель

Домашнее задание — это обязательная подготовка перед торговой сессией. Без выполнения "домашки" торговать нельзя.

## Этапы домашнего задания

### 1. Скрининг инструментов (см. @trends)

**Цель**: Найти инструменты, подходящие для торговли сегодня.

**ВАЖНО:** При анализе трендов, фаз рынка и силы тренда используй детальные правила из @trends.

**Критерии отбора**:
- **Волатильность**: ATR(5) выше среднего за последние 20 дней (см. @trends)
- **Объём**: Текущий объём выше среднего за последние 20 дней (минимум 1.2x, желателен контрастный объем 2-3x) (см. @trends)
- **Глобальный тренд (W1/MN)**: Определить общее направление рынка на старших таймфреймах (см. @trends)
- **Локальный тренд (D1/H1)**: Чёткий тренд на D1 или H4, либо инструмент у границы диапазона (см. @trends)
- **Сила тренда**: Оценить силу тренда (ценовое действие + объемы + ATR) (см. @trends)
- **Фаза рынка**: Определить текущую фазу (накопление/импульс/коррекция/ретест/флэт/истощение) — избегать инструментов во флэте в середине диапазона (см. @trends)
- **Ликвидность**: Спред не более 0.1% для акций, 0.05% для фьючерсов

**Инструменты для скрининга**:
- Используй `get_market_stats` для получения метрик (ATR(5), объемы)
- Используй `get_stock_history` для анализа тренда на разных таймфреймах (W1, D1, H1) (см. @trends)
- Используй `get_real_time_quote` для проверки спреда

**Результат**: Список кандидатов (10-20 инструментов)

### 2. Анализ уровней

**ВАЖНО:** При определении уровней используй детальные правила из @levels. Ниже приведено краткое резюме ключевых моментов.

#### Получение исторических данных

**Обязательно использовать `get_stock_history` с параметрами интервала времени:**
- **`start_date`**: дата 6 месяцев назад от текущей даты (формат: "YYYY-MM-DD")
- **`end_date`**: текущая дата (формат: "YYYY-MM-DD")
- **`interval`**: "1d" (дневной таймфрейм) для анализа D1
- Для недельных (W1) и месячных (M1) уровней использовать агрегацию данных или запросы с соответствующими интервалами ("1wk", "1mo")
- Анализировать данные на таймфреймах D1 и выше (W1, M1)

**Пример:**
```python
# Для получения данных за последние 6 месяцев:
# start_date = (текущая_дата - 180 дней).strftime("%Y-%m-%d")
# end_date = текущая_дата.strftime("%Y-%m-%d")
# get_stock_history(symbol="SYMBOL", start_date=start_date, end_date=end_date, interval="1d")
```

Для каждого инструмента определить:

#### Приоритетные типы уровней (см. @levels для деталей)

**Самые сильные уровни:**
- **Уровни излома тренда** — формируются в точках, где предыдущий тренд изменил направление (самые сильные)
- **Уровни с ложными пробоями** — уровни, вокруг которых произошло несколько ложных пробоев
- **Зеркальные уровни (Mirror Level)** — уровни сопротивления, ставшие поддержкой, и наоборот

#### Исторические уровни

На основе данных за последние 6 месяцев (полученных через `get_stock_history`):
- **D1**: High/Low последних 5-10 дней (особенно последние 2-3 дня)
- **W1**: High/Low последних 4-8 недель
- **M1**: High/Low последних 3-6 месяцев (могут оставаться актуальными годами)

#### Психологические уровни (круглые числа)

- Для акций: 10, 50, 100, 150, 200, 250, 300...
- Для фьючерсов: 5000, 5100, 5200...
- Для валют: 1.10, 1.20, 1.30...
- Особенно значимы при совпадении с историческими уровнями

#### Уровни предыдущего дня

- **Yesterday High**: Максимум предыдущего дня
- **Yesterday Low**: Минимум предыдущего дня
- **Yesterday Close**: Закрытие предыдущего дня

#### Уровни открытия

- **Week Open**: Цена открытия недели
- **Month Open**: Цена открытия месяца

#### Уровни на основе гэпов

- Границы ценовых разрывов (гэпов) могут служить сильными уровнями
- В 7-8 случаях из 10 такие уровни успешно удерживаются

#### Оценка силы уровня (см. @levels для детальных критериев)

**ВАЖНО:** При подсчете касаний уровней учитывается допуск 0.5% от цены уровня. Касанием считается, если цена находится в пределах этого допуска от уровня, а не только точное попадание. Это соответствует концепции ценовых зон, а не точных цен.

**Формула расчета касания:**
```
Допуск = Цена_уровня × 0.005 (0.5%)
Касание = True, если |Цена - Уровень| ≤ Допуск
```

**Примеры:**
- Уровень 100.00: касание, если цена в диапазоне [99.50, 100.50]
- Уровень 50.00: касание, если цена в диапазоне [49.75, 50.25]

При анализе исторических данных нужно проверять, находится ли цена (High/Low/Close бара) в пределах допуска 0.5% от уровня.

**Очень сильный уровень:**
- Излом тренда, зеркальный уровень, множественные ложные пробои
- Точность отработки "тик в тик" (до пятого знака)
- Подтверждение через пробой (даже небольшой)
- Уровень не "пилился" (не тестировался множество раз без пробоя)
- Значительный объем, старший таймфрейм (W1, M1)

**Сильный уровень:**
- 3+ касания (с учетом допуска 0.5%), подтверждение через пробой
- Низкая околоуровневая волатильность

**Средний уровень:**
- 2 касания (с учетом допуска 0.5%), недавний уровень

**Слабый уровень:**
- 1 касание (с учетом допуска 0.5%), без подтверждения, "затерт"

**Ключевой сигнал:** Отсутствие реакции на сильный уровень — самый важный сигнал пробоя (см. @levels для деталей)

#### Фильтрация уровней

**После определения всех уровней:**
1. Оценить силу каждого уровня по критериям из @levels
2. Если найдено более 10 уровней, оставить только **5-10 самых сильных**
3. Приоритет отдавать в следующем порядке:
   - Уровни излома тренда
   - Зеркальные уровни
   - Уровни с ложными пробоями
   - Учитывать таймфрейм (M1 > W1 > D1)
   - Учитывать количество касаний и подтверждение
4. Отсортировать оставшиеся уровни по цене (от максимальной к минимальной)

**Формат вывода**:

Все уровни консолидируются в одну таблицу, отсортированную по цене сверху вниз (от максимальной к минимальной):

```markdown
## Уровни

| Цена | Тип уровня | Тип | Сила | Касания | Подтверждение | Комментарий |
|------|------------|-----|------|---------|---------------|-------------|
| 189.50 | Сопротивление | Излом тренда + W1 High | Очень сильный | 4 (с обеих сторон) | Пробой + точность тик-в-тик | Зеркальный уровень |
| 187.00 | Сопротивление | Круглое число | Средний | 2 | Нет | Психологический уровень |
| 185.50 | Сопротивление | D1 High (5 дней) | Сильный | 3 | Касание + пробой | ... |
| 182.30 | Поддержка | Yesterday Low | Слабый | 1 | Нет | Вчерашний минимум |
| 180.00 | Поддержка | Круглое число + D1 Low | Сильный | 3 | Касание + пробой | Психологический уровень, совпадение |
| 178.50 | Поддержка | D1 Low (10 дней) | Сильный | 4 | Множественные касания | Отскок 4 раза, не "пилился" |
```

**Примечания к формату:**
- **Цена**: Сортировка сверху вниз (от максимальной к минимальной)
- **Тип уровня**: Поддержка или Сопротивление
- **Тип** должен указывать приоритетный тип (излом тренда, ложные пробои, зеркальный), таймфрейм (D1, W1, M1) и дополнительные характеристики
- **Сила**: Очень сильный / Сильный / Средний / Слабый
- **Касания**: количество и с какой стороны (с обеих сторон или с одной). **Важно:** Касания учитываются с допуском 0.5% от цены уровня (цена не обязательно должна попадать точно в уровень)
- **Подтверждение**: множественные касания, пробой, точность отработки, ложные пробои, объем, многотаймфреймное совпадение
- В таблицу включаются только 5-10 самых сильных уровней после фильтрации

### 3. Проверка предпосылок (см. @trends)

**ВАЖНО:** При проверке тренда и фазы рынка используй детальные правила из @trends.

Чеклист предпосылок для добавления на лист:

- [ ] **Глобальный тренд (W1/MN)**: Определен и синхронизирован с локальным (см. @trends)
- [ ] **Локальный тренд (D1/H1)**: Инструмент в тренде ИЛИ у границы диапазона (см. @trends)
- [ ] **Сила тренда**: Оценена (ценовое действие + объемы + ATR) (см. @trends)
- [ ] **Фаза рынка**: Определена (не флэт в середине диапазона) (см. @trends)
- [ ] **Уровень**: Есть чёткий уровень для работы (не более 0.5% от текущей цены)
- [ ] **Волатильность**: ATR(5) достаточен для движения к TP (минимум 2x от риска) (см. @trends)
- [ ] **Объём**: Объём выше среднего (минимум 1.2x от 20-дневного среднего, желателен контрастный объем 2-3x) (см. @trends)
- [ ] **Новости**: Нет важных новостей в ближайшие 2 часа
- [ ] **Время сессии**: Подходящее время для торговли (не перед закрытием без плана)

**Если все предпосылки выполнены** → можно добавить на лист
**Если хотя бы одна не выполнена** → пропустить с пояснением

### 4. Формирование торгового сценария (см. @trends)

Для каждого инструмента, прошедшего проверку, создать торговый сценарий:

**ВАЖНО:** При формировании торгового сценария обязательно учитывать информацию из @trends (глобальный/локальный тренд, сила тренда, фаза рынка, ATR(5) для стопов, расчетный стоп = 20-30% от ATR).

**ВАЖНО:** При формировании торгового сценария используй принципы торговли на уровнях из @levels, особенно принцип близости (торговля максимально близко к уровню).

#### Обязательные элементы:

1. **Направление**: Long или Short (на основе глобального и локального тренда, см. @trends)
2. **Триггер входа**: Чёткое условие (например, "Пробой 185.50 с ретестом и подтверждением объемом") (см. @trends)
3. **Точка входа**: Конкретная цена или условие
   - **Принцип близости:** Вход должен быть максимально близко к уровню (см. @levels)
   - Избегать входа на вторичном движении (после пробоя с возвратом)
4. **Стоп-лосс** (см. @trends): 
   - Не более 1% от депозита на сделку
   - **Приоритет технического стопа:** Предпочитать технический стоп (за уровнем), если он не превышает расчетный (20-30% от ATR(5)) (см. @trends)
   - Рассчитать технический стоп: за уровнем поддержки/сопротивления (чуть за уровнем)
   - Рассчитать расчетный стоп: 20-30% от ATR(5) (например, если ATR = $1.00, то расчетный стоп = $0.20 - $0.30) (см. @trends)
   - Минимум 0.2% от цены инструмента
   - Минимум 0.5 ATR от входа (избежать рыночного шума) (см. @trends)
   - Для круглых чисел: стоп может размещаться чуть ниже/выше (например, 9.94 ниже 10.00)
5. **Тейк-профит**:
   - Минимум 2:1 к риску (R:R ≥ 2:1)
   - Желательно несколько уровней (TP1, TP2)
6. **Размер позиции**: Рассчитать на основе риска

**Формат вывода**:
```markdown
## Торговый сценарий (см. @trends)

**Направление**: Long (на основе глобального тренда: восходящий W1)
**Триггер**: Пробой 185.50 с ретестом и подтверждением объёма (контрастный объем 2-3x среднего)
**Точка входа**: 185.52 (максимально близко к уровню 185.50 - принцип близости, см. @levels)
**Стоп-лосс**: 
  - Технический стоп: 184.80 (за уровнем 184.90)
  - Расчетный стоп (ATR): 185.40 (20-30% от ATR(5) = $0.70, используем 30% = $0.21)
  - **Выбранный стоп**: 184.80 (технический, риск: 0.39% = $0.72)
**Тейк-профит 1**: 187.00 (R:R 2:1)
**Тейк-профит 2**: 189.50 (R:R 5.5:1)
**Размер позиции**: X акций (риск: $Y = 1% депозита)
```

### 5. Принятие решения

После анализа всех элементов:

**Добавить на лист**, если:
- Все предпосылки выполнены
- Есть чёткий торговый сценарий
- Риск-менеджмент соблюдён

**Пропустить**, если:
- Не выполнена хотя бы одна предпосылка
- Нет чёткого уровня для работы
- Риск слишком велик
- Недостаточно данных для анализа

**Формат рекомендации**:
```markdown
## Рекомендация

✅ **Добавить на лонг-лист** / ❌ **Пропустить**

**Причина**: 
- Все предпосылки выполнены
- Чёткий уровень 185.50
- R:R 2:1 минимум
```

## Структура файла домашнего задания

Файл сохраняется в `homework/YYYY-MM-DD/SYMBOL.md`:

```markdown
# {SYMBOL} - {DATE}

## Текущая ситуация
- Цена: {price}
- Изменение: {change}%
- Объём: {volume} (vs avg: {volume_vs_avg})
- ATR(5): {atr} (расчетный, без паранормальных баров, см. @trends)

## Тренды и фазы рынка (см. @trends)
- **Глобальный тренд (W1/MN):** {global_trend} (восходящий/нисходящий/боковой)
- **Локальный тренд (D1/H1):** {local_trend} (восходящий/нисходящий/боковой)
- **Синхронизация:** {sync_status} (синхронизированы/противоречат)
- **Сила тренда:** {trend_strength} (сильный/средний/слабый)
  - Ценовое действие: {price_action}
  - Объемы: {volume_analysis}
  - ATR: {atr_analysis}
- **Фаза рынка:** {market_phase} (накопление/импульс/коррекция/ретест/флэт/истощение)

## Уровни

| Цена | Тип уровня | Тип | Сила | Касания | Подтверждение | Комментарий |
|------|------------|-----|------|---------|---------------|-------------|
| ... | Сопротивление/Поддержка | ... | ... | ... | ... | ... |

*Таблица отсортирована по цене сверху вниз (от максимальной к минимальной). Включены только 5-10 самых сильных уровней.*

## Предпосылки
[чеклист]

## Торговый сценарий (см. @trends)
**Направление**: Long/Short (на основе глобального тренда: {global_trend})
**Триггер**: ... (что должно произойти для входа)
**Вход**: ... (максимально близко к уровню - принцип близости)
**Стоп-лосс**: 
  - Технический стоп: ... (за уровнем {level_price})
  - Расчетный стоп (ATR): ... (20-30% от ATR(5) = {calculated_stop})
  - **Выбранный стоп**: ... (технический/расчетный, риск: ...%)
**Тейк-профит**: ... (R:R минимум 2:1)

## Рекомендация
[решение и причина]
```

## Важные правила

1. **Никогда не торгуй без домашнего задания**
2. **Всегда расписывай сценарий до начала сессии** (эмоции не должны влиять)
3. **Стоп-лосс обязателен** для каждой сделки
4. **Минимум 2:1 R:R** — иначе не торговать
5. **Максимум 1% риска** на сделку
