---
description: Правила для выполнения домашнего задания - скрининг инструментов, анализ уровней, определение предпосылок и формирование торговых сценариев
alwaysApply: false
---

# Домашнее задание - Workflow подготовки к торговой сессии

**КРИТИЧЕСКИ ВАЖНО:** Все операции получения данных и работы с инструментами выполняются **ТОЛЬКО** через MCP-инструменты. Используй `call_mcp_tool` для вызова всех инструментов из сервера `user-markethub-mcp`. **НЕ создавай никаких Python-скриптов** для получения данных или выполнения операций.

## Цель

Домашнее задание — это обязательная подготовка перед торговой сессией. Без выполнения "домашки" торговать нельзя.

## Этапы домашнего задания

### 1. Скрининг инструментов (см. @trends)

**Цель**: Найти инструменты, подходящие для торговли сегодня.

**ВАЖНО:** При анализе трендов, фаз рынка и силы тренда используй детальные правила из @trends.

**Критерии отбора** (из базы знаний):

**Для акций (US Market)**:
- **Объём**: Average Volume > 300,000 (стандарт) или > 500,000 (высокая ликвидность). Избегать инструментов с объёмом < 300,000 (или < 1M для penny stocks)
- **Цена**: Фильтр для акций >$0.50 (чтобы 100 акций > $50). Отдельные списки для акций >$10 и <$10. Для основного списка рассматривать бумаги от **10 долларов**
- **Рынок**: Только США (исключить ADR), исключить ETF (кроме SPY, IWM)
- **Волатильность**: Average True Range > 1 доллар (Over 1)
- **Критерии отбора**: Бумага недалеко сшла к уровню, очень сильная дневная свеча
- **Правило отклонения**: Строго применять правило "95%" — **95%** просмотренных графиков должны быть отклонены. Торговать только 5% с "супер понятной картинкой"
- **Фильтрация инструментов**: Выбирать только "жесткие" ситуации. Исключать "зараженные зоны", глубокие ложные пробои, "пилу"

**Для криптовалют**:
- **Ликвидность**: Фильтр для ликвидности > $1,000,000 (или >100 BTC для пар)
- **Пороги объёма**:
  - Риск $100: Объём **> 60–70 миллионов**
  - Риск $200+: Объём **> 100 миллионов**
  - Минимум: **> 50 миллионов** (манипулятивные инструменты)
- **Проверка спота**: Для монет с объёмом 50M на фьючерсах, объём спота должен быть **15–20 миллионов+**

**Для Forex**:
- Начать с 10–15 пар. Избегать торговли одной и той же парой каждый день; ротировать для поиска активных рынков
- **Формула ликвидности**: `Коэффициент = (0.1 * ATR_Daily) / Spread`. Порог должен быть **> 4** (идеально **> 5**)

**Общие критерии** (см. @trends):
- **Глобальный тренд (W1/MN)**: Определить общее направление рынка на старших таймфреймах (см. @trends)
- **Локальный тренд (D1/H1)**: Чёткий тренд на D1 или H4, либо инструмент у границы диапазона (см. @trends)
- **Сила тренда**: Оценить силу тренда (ценовое действие + объемы + ATR) (см. @trends)
- **Фаза рынка**: Определить текущую фазу (накопление/импульс/коррекция/ретест/флэт/истощение) — избегать инструментов во флэте в середине диапазона (см. @trends)

**Инструменты для скрининга**:

**ВАЖНО:** Все инструменты вызываются через MCP с использованием `call_mcp_tool` из сервера `user-markethub-mcp`:

- **`get_market_stats`**: Используй для получения метрик (ATR, Average Volume, текущий объём) — только для акций
  - `server`: `"user-markethub-mcp"`
  - `toolName`: `"get_market_stats"`
  - `arguments`: `{"symbol": "AAPL"}`

- **Для акций**: Используй `get_stock_history` для анализа тренда на разных таймфреймах (W1, D1, H1) (см. @trends)
  - `server`: `"user-markethub-mcp"`
  - `toolName`: `"get_stock_history"`
  - `arguments`: `{"symbol": "AAPL", "interval": "1d", "period": "6mo"}` или с `start_date` и `end_date` (для анализа уровней используется 6 месяцев, для генерации графиков - 5 месяцев)

- **Для криптовалют**: Используй `get_crypto_history` для анализа тренда на разных таймфреймах (W1, D1, H1) (см. @trends)
  - `server`: `"user-markethub-mcp"`
  - `toolName`: `"get_crypto_history"`
  - `arguments`: `{"symbol": "BTCUSDT", "interval": "1d", "period": "6mo", "exchange": "binance"}` (exchange опционально)

- **`get_real_time_quote`**: Используй для проверки спреда и текущей цены (работает для акций и криптовалют)
  - `server`: `"user-markethub-mcp"`
  - `toolName`: `"get_real_time_quote"`
  - `arguments`: `{"symbol": "AAPL"}` или `{"symbol": "BTCUSDT"}`

**Проверки**:
- Для акций: проверить Average Volume > 300k (стандарт) или > 500k (высокая ликвидность)
- Для акций: проверить ATR > $1
- Для акций: проверить цену >$0.50 (или >$10 для основного списка)
- Для криптовалют: проверить ликвидность и объём согласно порогам
- Для Forex: рассчитать коэффициент ликвидности = (0.1 * ATR_Daily) / Spread

**Результат**: Список кандидатов (10-20 инструментов для акций, 26-30 для домашнего задания)

### 2. Анализ уровней

**ВАЖНО:** При определении уровней используй детальные правила из @levels. Ниже приведено краткое резюме ключевых моментов.

#### Получение исторических данных

**ВАЖНО:** Все операции получения данных выполняются через MCP-инструменты. Используй `call_mcp_tool` для вызова инструментов из сервера `user-markethub-mcp`.

**ВАЖНО:** Использовать правильный инструмент в зависимости от типа инструмента:
- **Для акций**: использовать `get_stock_history` (вызывает ошибку для криптовалют)
- **Для криптовалют**: использовать `get_crypto_history` (с опциональным параметром `exchange`)

**Обязательно использовать параметры `start_date` и `end_date` (формат: "YYYY-MM-DD"):**
- **`start_date`**: дата 6 месяцев назад от текущей даты (формат: "YYYY-MM-DD") - для анализа уровней
- **`end_date`**: текущая дата (формат: "YYYY-MM-DD")
- **`interval`**: "1d" (дневной таймфрейм) для анализа D1
- Для недельных (W1) и месячных (M1) уровней использовать агрегацию данных или запросы с соответствующими интервалами ("1wk", "1mo")
- Анализировать данные на таймфреймах D1 и выше (W1, M1)
- **ВАЖНО:** Для генерации графиков используется диапазон 5 месяцев (см. раздел "Генерация графика")

**Примеры использования MCP-инструментов:**

Для акций:
- `server`: `"user-markethub-mcp"`
- `toolName`: `"get_stock_history"`
- `arguments`: 
  - `symbol`: тикер акции (например, "AAPL")
  - `start_date`: дата 6 месяцев назад в формате "YYYY-MM-DD" (например, "2025-07-25")
  - `end_date`: текущая дата в формате "YYYY-MM-DD" (например, "2026-01-25")
  - `interval`: "1d" для дневного таймфрейма

Для криптовалют:
- `server`: `"user-markethub-mcp"`
- `toolName`: `"get_crypto_history"`
- `arguments`: 
  - `symbol`: тикер криптовалюты (например, "BTCUSDT")
  - `start_date`: дата 6 месяцев назад в формате "YYYY-MM-DD" (например, "2025-07-25")
  - `end_date`: текущая дата в формате "YYYY-MM-DD" (например, "2026-01-25")
  - `interval`: "1d" для дневного таймфрейма
  - `exchange`: опционально, название биржи (например, "binance")

Для каждого инструмента определить:

#### Приоритетные типы уровней (см. @levels для деталей)

**Самые сильные уровни:**
- **Уровни излома тренда** — формируются в точках, где предыдущий тренд изменил направление (самые сильные)
- **Уровни с ложными пробоями** — уровни, вокруг которых произошло несколько ложных пробоев
- **Зеркальные уровни (Mirror Level)** — уровни сопротивления, ставшие поддержкой, и наоборот

#### Исторические уровни

На основе данных за последние 6 месяцев (полученных через MCP-инструменты `get_stock_history` для акций или `get_crypto_history` для криптовалют через `call_mcp_tool`, сервер `user-markethub-mcp`):
- **D1**: High/Low последних 5-10 дней (особенно последние 2-3 дня)
- **W1**: High/Low последних 4-8 недель
- **M1**: High/Low последних 3-6 месяцев (могут оставаться актуальными годами)

#### Психологические уровни (круглые числа)

- Для акций: 10, 50, 100, 150, 200, 250, 300...
- Для фьючерсов: 5000, 5100, 5200...
- Для валют: 1.10, 1.20, 1.30...
- Особенно значимы при совпадении с историческими уровнями

#### Уровни предыдущего дня

- **Yesterday High**: Максимум предыдущего дня
- **Yesterday Low**: Минимум предыдущего дня
- **Yesterday Close**: Закрытие предыдущего дня

#### Уровни открытия

- **Week Open**: Цена открытия недели
- **Month Open**: Цена открытия месяца

#### Уровни на основе гэпов

- Границы ценовых разрывов (гэпов) могут служить сильными уровнями
- В 7-8 случаях из 10 такие уровни успешно удерживаются

#### Оценка силы уровня (см. @levels для детальных критериев)

**ВАЖНО:** При подсчете касаний уровней учитывается допуск 0.5% от цены уровня. Касанием считается, если цена находится в пределах этого допуска от уровня, а не только точное попадание. Это соответствует концепции ценовых зон, а не точных цен.

**Формула расчета касания:**
```
Допуск = Цена_уровня × 0.005 (0.5%)
Касание = True, если |Цена - Уровень| ≤ Допуск
```

**Примеры:**
- Уровень 100.00: касание, если цена в диапазоне [99.50, 100.50]
- Уровень 50.00: касание, если цена в диапазоне [49.75, 50.25]

При анализе исторических данных нужно проверять, находится ли цена (High/Low/Close бара) в пределах допуска 0.5% от уровня.

**Очень сильный уровень:**
- Излом тренда, зеркальный уровень, множественные ложные пробои
- Точность отработки "тик в тик" (до пятого знака)
- Подтверждение через пробой (даже небольшой)
- Уровень не "пилился" (не тестировался множество раз без пробоя)
- Значительный объем, старший таймфрейм (W1, M1)

**Сильный уровень:**
- 3+ касания (с учетом допуска 0.5%), подтверждение через пробой
- Низкая околоуровневая волатильность

**Средний уровень:**
- 2 касания (с учетом допуска 0.5%), недавний уровень

**Слабый уровень:**
- 1 касание (с учетом допуска 0.5%), без подтверждения, "затерт"

**Ключевой сигнал:** Отсутствие реакции на сильный уровень — самый важный сигнал пробоя (см. @levels для деталей)

#### Фильтрация уровней

**После определения всех уровней:**
1. Оценить силу каждого уровня по критериям из @levels
2. **Исключить слабые уровни**: Если найдено 3+ уровня с силой "Средний" или выше, исключить все слабые уровни из дальнейшего анализа
3. Если найдено более 10 уровней, оставить только **5-10 самых сильных**
4. Приоритет отдавать в следующем порядке:
   - Уровни излома тренда
   - Зеркальные уровни
   - Уровни с ложными пробоями
   - Учитывать таймфрейм (M1 > W1 > D1)
   - Учитывать количество касаний и подтверждение
5. Отсортировать оставшиеся уровни по цене (от максимальной к минимальной)

**Формат вывода**:

Все уровни консолидируются в одну таблицу, отсортированную по цене сверху вниз (от максимальной к минимальной):

```markdown
## Уровни

| Цена | Тип уровня | Тип | Сила | Касания | Подтверждение | Комментарий |
|------|------------|-----|------|---------|---------------|-------------|
| 189.50 | Сопротивление | Излом тренда + W1 High | Очень сильный | 4 (с обеих сторон) | Пробой + точность тик-в-тик | Зеркальный уровень |
| 187.00 | Сопротивление | Круглое число | Средний | 2 | Нет | Психологический уровень |
| 185.50 | Сопротивление | D1 High (5 дней) | Сильный | 3 | Касание + пробой | ... |
| 180.00 | Поддержка | Круглое число + D1 Low | Сильный | 3 | Касание + пробой | Психологический уровень, совпадение |
| 178.50 | Поддержка | D1 Low (10 дней) | Сильный | 4 | Множественные касания | Отскок 4 раза, не "пилился" |
```

**Примечания к формату:**
- **Цена**: Сортировка сверху вниз (от максимальной к минимальной)
- **Тип уровня**: Поддержка или Сопротивление
- **Тип** должен указывать приоритетный тип (излом тренда, ложные пробои, зеркальный), таймфрейм (D1, W1, M1) и дополнительные характеристики
- **Сила**: Очень сильный / Сильный / Средний / Слабый
- **Касания**: количество и с какой стороны (с обеих сторон или с одной). **Важно:** Касания учитываются с допуском 0.5% от цены уровня (цена не обязательно должна попадать точно в уровень)
- **Подтверждение**: множественные касания, пробой, точность отработки, ложные пробои, объем, многотаймфреймное совпадение
- В таблицу включаются только 5-10 самых сильных уровней после фильтрации

### 3. Проверка предпосылок (см. @trends)

**ВАЖНО:** При проверке тренда и фазы рынка используй детальные правила из @trends.

#### Проверка корреляции

**Цель**: Убедиться, что инструмент имеет "собственную жизнь" или проверить корреляцию с индексами для принятия решения о входе.

**Основные индексы для проверки**:
- **S&P 500** (SPY) — основной индекс для акций США
- **NASDAQ** (QQQ) — технологический сектор
- **Dow Jones** (DIA) — промышленный индекс
- **VIX** — индекс волатильности

**Алгоритм проверки корреляции**:

1. **Определить основной индекс** для инструмента:
   - Для акций США: S&P 500 (SPY)
   - Для технологических акций: NASDAQ (QQQ)
   - Для криптовалют: Bitcoin (BTC) для альткоинов

2. **Получить данные коррелирующего инструмента** (через MCP-инструменты):
   - Для акций и индексов: использовать `get_stock_history` через `call_mcp_tool` (сервер `user-markethub-mcp`) для получения исторических данных индекса
   - Для криптовалют: использовать `get_crypto_history` через `call_mcp_tool` (сервер `user-markethub-mcp`) для получения исторических данных (например, BTCUSDT для альткоинов)
   - Использовать `get_real_time_quote` через `call_mcp_tool` (сервер `user-markethub-mcp`) для текущей котировки (работает для акций и криптовалют)

3. **Оценить корреляцию**:
   - **Для акций**: Предпочтение инструментам, которые **не коррелируют** с индексом и имеют "собственную жизнь"
   - **Исключения**: Для некоторых инструментов (например, Apple) корреляция с индексом критична; для InPlay (летящих на новостях) корреляция вторична
   - **Проверка синхронности индексов**: Для акций проверить синхронность Dow Jones, Nasdaq и S&P 500. Дивергенция между индексами — сигнал риска

4. **Использование корреляции как фильтра**:
   - Если есть сигнал на вход по основному инструменту, проверить коррелирующий инструмент
   - **Прямая корреляция**: Если сигнал на "Продажу" по инструменту А, а инструмент Б (с прямой связью) уперся в сильный уровень поддержки и не хочет падать — **отклонить сигнал**
   - **Обратная корреляция**: Если сигнал на "Продажу" по инструменту А, а инструмент Б (с обратной связью, например, DXY для EURUSD) пробил уровень и идет вниз (что должно толкать инструмент А вверх) — **отклонить сигнал**
   - **Общее правило**: Не открывать сделку, если логика движения связанного актива запрещает движение вашего актива в нужную сторону

5. **Проверка состояния рынка**:
   - Если рынок падает (S&P 500 в минусе), избегать лонгов в слабых акциях
   - Если рынок растет, но акция не обновляет максимумы и начинает "закрываться" — возможен шорт от ключевых уровней поддержки

**Инструменты для проверки корреляции** (все через MCP с использованием `call_mcp_tool`, сервер `user-markethub-mcp`):
- Для акций: используй `get_stock_history` для сравнения динамики инструмента с индексом (SPY, QQQ, DIA)
- Для криптовалют: используй `get_crypto_history` для сравнения динамики инструмента с индексом (например, BTCUSDT для альткоинов)
- Используй `get_real_time_quote` для текущего состояния индекса (работает для акций и криптовалют)
- Для акций: используй `get_market_stats` для анализа коррелирующих инструментов

Чеклист предпосылок для добавления на лист:

- [ ] **Глобальный тренд (W1/MN)**: Определен и синхронизирован с локальным (см. @trends)
- [ ] **Локальный тренд (D1/H1)**: Инструмент в тренде ИЛИ у границы диапазона (см. @trends)
- [ ] **Сила тренда**: Оценена (ценовое действие + объемы + ATR) (см. @trends)
- [ ] **Фаза рынка**: Определена (не флэт в середине диапазона) (см. @trends)
- [ ] **Уровень**: Есть чёткий уровень для работы (не более 0.5% от текущей цены)
- [ ] **Волатильность**: ATR(5) достаточен для движения к TP (минимум 2x от риска) (см. @trends)
- [ ] **Объём**: Объём выше среднего (минимум 1.2x от 20-дневного среднего, желателен контрастный объем 2-3x) (см. @trends)
- [ ] **Корреляция**: Проверена корреляция с основным индексом (S&P 500, NASDAQ, Dow Jones). Инструмент имеет "собственную жизнь" или корреляция не противоречит направлению сделки
- [ ] **Новости**: Нет важных новостей в ближайшие 2 часа
- [ ] **Время сессии**: Подходящее время для торговли (не перед закрытием без плана)

**Если все предпосылки выполнены** → можно добавить на лист
**Если хотя бы одна не выполнена** → пропустить с пояснением

### 4. Формирование торгового сценария (см. @trends)

Для каждого инструмента, прошедшего проверку, создать торговый сценарий:

**ВАЖНО:** При формировании торгового сценария обязательно учитывать информацию из @trends (глобальный/локальный тренд, сила тренда, фаза рынка, ATR(5) для стопов, расчетный стоп = 20-30% от ATR).

**ВАЖНО:** При формировании торгового сценария используй принципы торговли на уровнях из @levels, особенно принцип близости (торговля максимально близко к уровню).

**КРИТИЧЕСКИ ВАЖНО:** НИКОГДА не используй слабые уровни для формирования торговых сценариев. Для точки входа используй только уровни с силой "Сильный" или "Очень сильный". Для стоп-лоссов и тейк-профитов можно использовать уровни с силой "Средний" или выше.

#### Обязательные элементы:

1. **Направление**: Long или Short (на основе глобального и локального тренда, см. @trends)
2. **Триггер входа**: Чёткое условие (например, "Пробой 185.50 с ретестом и подтверждением объемом") (см. @trends)
3. **Точка входа**: Конкретная цена или условие
   - **Принцип близости:** Вход должен быть максимально близко к уровню (см. @levels)
   - **Запрет слабых уровней:** Уровень для входа должен быть минимум "Сильный" по силе. Слабые и средние уровни не используются для входа
   - Избегать входа на вторичном движении (после пробоя с возвратом)
4. **Стоп-лосс** (см. @trends): 
   - Не более 1% от депозита на сделку
   - **Приоритет технического стопа:** Предпочитать технический стоп (за уровнем), если он не превышает расчетный (20-30% от ATR(5)) (см. @trends)
   - Рассчитать технический стоп: за уровнем поддержки/сопротивления (чуть за уровнем)
   - **Запрет слабых уровней:** Технический стоп должен размещаться за уровнем минимум "Средний" по силе. Слабые уровни не используются для размещения стопов
   - Рассчитать расчетный стоп: 20-30% от ATR(5) (например, если ATR = $1.00, то расчетный стоп = $0.20 - $0.30) (см. @trends)
   - Минимум 0.2% от цены инструмента
   - Минимум 0.5 ATR от входа (избежать рыночного шума) (см. @trends)
   - Для круглых чисел: стоп может размещаться чуть ниже/выше (например, 9.94 ниже 10.00)
5. **Тейк-профит**:
   - Минимум 2:1 к риску (R:R ≥ 2:1)
   - Желательно несколько уровней (TP1, TP2)
   - **Запрет слабых уровней:** Тейк-профиты должны размещаться на уровнях минимум "Средний" по силе. Слабые уровни не используются для тейк-профитов
6. **Размер позиции**: Рассчитать на основе риска

**Формат вывода**:
```markdown
## Торговый сценарий (см. @trends)

**Направление**: Long (на основе глобального тренда: восходящий W1)

**Триггер**: Пробой 185.50 с ретестом и подтверждением объёма (контрастный объем 2-3x среднего)

**Точка входа**: 185.52 (максимально близко к уровню 185.50 - принцип близости, см. @levels)

**Стоп-лосс**: 
  - Технический стоп: 184.80 (за уровнем 184.90)
  - Расчетный стоп (ATR): 185.40 (20-30% от ATR(5) = $0.70, используем 30% = $0.21)
  - **Выбранный стоп**: 184.80 (технический, риск: 0.39% = $0.72)

**Тейк-профит 1**: 187.00 (R:R 2:1)

**Тейк-профит 2**: 189.50 (R:R 5.5:1)
**Размер позиции**: X акций (риск: $Y = 1% депозита)
```

### 5. Принятие решения

После анализа всех элементов:

**Добавить на лист**, если:
- Все предпосылки выполнены
- Есть чёткий торговый сценарий
- Риск-менеджмент соблюдён

**Пропустить**, если:
- Не выполнена хотя бы одна предпосылка
- Нет чёткого уровня для работы
- Риск слишком велик
- Недостаточно данных для анализа

**Формат рекомендации**:
```markdown
## Рекомендация

✅ **Добавить на лонг-лист** / ❌ **Пропустить**

**Причина**: 
- Все предпосылки выполнены
- Чёткий уровень 185.50
- R:R 2:1 минимум
```

### 6. Ведение Summary файла

**ВАЖНО:** После анализа каждого инструмента (независимо от результата - добавлен на лист или пропущен) необходимо обновить Summary файл.

**Расположение файла**: `homework/YYYY-MM-DD/Summary-YYYY-MM-DD.md`

**Правила работы с Summary файлом**:

1. **Создание файла**: При первом анализе инструмента за день создай файл `Summary-YYYY-MM-DD.md` в папке `homework/YYYY-MM-DD/`
2. **Обновление записи**: Если тикер уже есть в таблице - обнови его запись (замени строку)
3. **Добавление записи**: Если тикера нет в таблице - добавь новую строку
4. **Формат таблицы**: Используй таблицу с колонками: Тикер (ссылка), Рекомендация, Комментарий

**Формат Summary файла**:

```markdown
# Summary - YYYY-MM-DD

| Тикер | Рекомендация | Комментарий |
|-------|--------------|-------------|
| [MU](./MU.md) | ✅ Добавить на лонг-лист | Сильнейший тренд, обновление ATH. Вход на пробой 412.50 или откат к 390. |
| [STX](./STX.md) | ✅ Добавить на лонг-лист | Поджатие к 350.00. Отличный кандидат на пробой. |
| [UNH](./UNH.md) | ✅ Добавить на лонг-лист | Выход из базы, импульс. Цель 370+. |
| [ANET](./ANET.md) | ✅ Добавить на лонг-лист | Гэп силы, коррекция к поддержке. Вход от 135. |
| [AAPL](./AAPL.md) | ✅ Добавить на лонг-лист | Техничная коррекция лидера. Вход на возврате к 250. |
| [BTCUSDT (Binance)](./BTCUSDT-Binance.md) | ✅ Добавить на лонг-лист | Отскок от уровня излома. Вход на пробой 90,363. |
| [ETHUSDT (Bybit)](./ETHUSDT-Bybit.md) | ⚠️ Добавить (С осторожностью) | Сильный моментум, но резкий откат. Ждать реакции на 147. |
| [PSTG](./PSTG.md) | ✅ Добавить на лонг-лист | Коррекция на малом объеме к уровню 69. |
| [ILMN](./ILMN.md) | ⚠️ Добавить (С осторожностью) | Сильный моментум, но резкий откат. Ждать реакции на 147. |
| [SMCI](./SMCI.md) | ⚠️ Добавить (High Risk) | Попытка дна, высокий риск. Только для активной торговли. |
| [LLY](./LLY.md) | ❌ Пропустить | Боковик, "пила". Ждать выхода из диапазона 1015-1095. |
| [FSLR](./FSLR.md) | ❌ Пропустить | Нет четкого тренда, снижение объемов. |
```

**Правила для колонок**:

- **Тикер**: 
  - **Для акций и других инструментов**: Ссылка на файл с домашкой по тикеру в формате `[SYMBOL](./SYMBOL.md)`. Пример: `[AAPL](./AAPL.md)`
  - **Для криптовалют**: Ссылка на файл с домашкой по тикеру и бирже в формате `[SYMBOL (EXCHANGE)](./SYMBOL-EXCHANGE.md)`. Пример: `[BTCUSDT (Binance)](./BTCUSDT-Binance.md)`, `[ETHUSDT (Bybit)](./ETHUSDT-Bybit.md)`
  - Файл должен находиться в той же папке `homework/YYYY-MM-DD/`
- **Рекомендация**: 
  - `✅ Добавить на лонг-лист` - для инструментов, которые прошли все проверки и добавлены на лист
  - `⚠️ Добавить (С осторожностью)` - для инструментов с повышенным риском или требующих особого внимания
  - `⚠️ Добавить (High Risk)` - для инструментов с высоким риском
  - `❌ Пропустить` - для инструментов, которые не прошли проверку или были отклонены
- **Комментарий**: Краткое резюме ключевых моментов анализа - тренд, уровни, вход, причина решения. Должен быть информативным, но лаконичным (1-2 предложения)

**Важно**: 
- Summary файл должен обновляться после каждого обработанного инструмента
- Если тикер анализируется повторно в тот же день - обнови его запись в таблице
- Таблица должна быть отсортирована логично (например, сначала добавленные на лист, затем пропущенные, или по алфавиту)

### 7. Генерация графика

**КРИТИЧЕСКИ ВАЖНО:** Графики генерируются **ТОЛЬКО** через MCP инструмент `generate_chart` напрямую. **НЕ создавай никаких дополнительных скриптов** (Python, bash и т.д.) для генерации графиков.

**Инструмент**: Используй `call_mcp_tool` для вызова `generate_chart` из MCP сервера `user-markethub-mcp`

**Параметры для генерации графика**:

1. **Исторические данные**: Используй исторические данные, которые уже загружены для дневного таймфрейма (D1) при анализе уровней. Данные должны быть в формате OHLCV (массив объектов `StockPrice` с полями: `date`, `open`, `high`, `low`, `close`, `volume`)

2. **Уровни**: Преобразуй уровни, определенные в анализе, в формат `ChartLevel`:
   - **Тип уровня**: 
     - "Поддержка" → `support`
     - "Сопротивление" → `resistance`
   - **Сила уровня**:
     - "Слабый" → `weak`
     - "Средний" → `medium`
     - "Сильный" → `strong`
     - "Очень сильный" → `very_strong`
   - **Цена**: Используй цену уровня из анализа
   - **Метка (label)**: Опционально, можно указать краткое описание уровня (например, "D1 High", "Круглое число", "Излом тренда")

3. **Настройки графика**:
   - **chart_type**: `"candle"` (свечной график)
   - **style**: `"light"` или `"dark"` (по умолчанию `"light"`)
   - **renderer**: `"mplfinance"` или `"plotly"` (по умолчанию `"mplfinance"`)
   - **title**: Опционально, можно указать тикер и дату (например, "AAPL - 2026-01-25" или "BTCUSDT (Binance) - 2026-01-25")

**Расположение файла графика**: 
- **Для акций и других инструментов**: `homework/YYYY-MM-DD/SYMBOL.png` (например, `homework/2026-01-24/AAPL.png`)
- **Для криптовалют**: `homework/YYYY-MM-DD/SYMBOL-EXCHANGE.png` (например, `homework/2026-01-24/BTCUSDT-Binance.png`)
- Формат файла: `.png` или `.jpg` в зависимости от формата, возвращаемого инструментом

**Процесс генерации графика**:

**ВАЖНО:** Использовать диапазон **5 месяцев** для первой попытки генерации графика. При неудаче пробовать с меньшими диапазонами (4 месяца, затем 3 месяца).

1. **Подготовить данные**: Получить исторические данные OHLCV для генерации графика:
   - **Попытка 1**: Диапазон **5 месяцев** (`start_date`: дата 5 месяцев назад)
   - **Попытка 2** (если попытка 1 не удалась): Диапазон **4 месяца** (`start_date`: дата 4 месяца назад)
   - **Попытка 3** (если попытка 2 не удалась): Диапазон **3 месяца** (`start_date`: дата 3 месяца назад)
   - Использовать те же уровни из анализа (независимо от диапазона данных для графика)

2. **Вызвать MCP инструмент**: Использовать `call_mcp_tool` с параметрами:
   - `server`: `"user-markethub-mcp"`
   - `toolName`: `"generate_chart"`
   - `arguments`: объект с полем `input_data`, содержащим:
     - `ticker`: символ инструмента
     - `ohlcv`: массив исторических данных OHLCV для выбранного диапазона (5/4/3 месяца)
     - `levels`: массив уровней в формате `ChartLevel` (из анализа уровней)
     - `chart_type`: `"candle"`
     - `style`: `"light"` (или `"dark"`)
     - `renderer`: `"mplfinance"` (или `"plotly"`)
     - `title`: название графика с указанием фактического диапазона:
       - Для акций: "AAPL - 5 месяцев", "AAPL - 4 месяца", "AAPL - 3 месяца"
       - Для криптовалют: "BTCUSDT (Binance) - 5 месяцев", "ETHUSDT (Bybit) - 4 месяца" (с указанием биржи)

3. **Проверить успешность генерации**:
   - После каждого вызова `generate_chart` проверить существование файла через `read_file` или `list_dir`
   - Если файл существует и не пустой → **ОСТАНОВИТЬСЯ**, успех
   - Если файл не создан или пустой → попробовать с меньшим диапазоном (если попытки не исчерпаны)

4. **Сохранение графика**: 
   - MCP инструмент возвращает base64-encoded изображение
   - Декодировать base64 и сохранить изображение в файл:
     - Для акций: `homework/YYYY-MM-DD/SYMBOL.png`
     - Для криптовалют: `homework/YYYY-MM-DD/SYMBOL-EXCHANGE.png`
   - Добавить ссылку на график в файл с домашкой по инструменту

5. **Если все 3 попытки не удались**:
   - Остановиться и сообщить пользователю об ошибке
   - **НЕ продолжать** бесконечные попытки

**Добавление графика в файл домашнего задания**:

В файл домашнего задания добавить раздел с графиком:

**Для акций:**
```markdown
## График

![График {SYMBOL}](./{SYMBOL}.png)
```

**Для криптовалют:**
```markdown
## График

![График {SYMBOL} ({EXCHANGE})](./{SYMBOL}-{EXCHANGE}.png)
```

Или добавить ссылку в раздел "Текущая ситуация":

**Для акций:**
```markdown
## Текущая ситуация
- Цена: {price}
- Изменение: {change}%
- Объём: {volume} (vs avg: {volume_vs_avg})
- ATR(5): {atr} (расчетный, без паранормальных баров, см. @trends)

![График {SYMBOL}](./{SYMBOL}.png)
```

**Для криптовалют:**
```markdown
## Текущая ситуация
- Цена: {price}
- Изменение: {change}%
- Объём: {volume} (vs avg: {volume_vs_avg})
- ATR(5): {atr} (расчетный, без паранормальных баров, см. @trends)

![График {SYMBOL} ({EXCHANGE})](./{SYMBOL}-{EXCHANGE}.png)
```

**Важно**: 
- График должен генерироваться после создания файла с рекомендациями
- На графике должны быть отмечены все уровни из анализа (5-10 самых сильных уровней после фильтрации)
- **Диапазон данных для графика**: Начинать с **5 месяцев**, при неудаче пробовать **4 месяца**, затем **3 месяца**
- **Диапазон данных для анализа уровней**: **6 месяцев** (это отдельный процесс, не связанный с генерацией графика)
- Обновлять `title` графика в соответствии с фактическим диапазоном данных (5/4/3 месяца)
- Максимум 3 попытки генерации (5 → 4 → 3 месяца)
- После успешной генерации немедленно остановиться
- **НЕ создавай никаких скриптов** для генерации графиков - используй только MCP инструмент напрямую

## Структура файла домашнего задания

**ВАЖНО:** Используй формат, заданный в этих правилах, а не примеры из старых домашних заданий. Если пользователь не указал конкретный пример или конкретные правила, следуй формату, описанному ниже.

### Именование файлов

**Для акций и других инструментов:**
- Файл сохраняется в `homework/YYYY-MM-DD/SYMBOL.md`
- Пример: `homework/2026-01-24/AAPL.md`

**Для криптовалют:**
- **ВАЖНО:** Файл должен включать имя биржи в имени файла для различения анализа одной и той же пары на разных биржах
- Формат: `homework/YYYY-MM-DD/SYMBOL-EXCHANGE.md`
- Примеры: 
  - `homework/2026-01-24/BTCUSDT-Binance.md`
  - `homework/2026-01-24/BTCUSDT-Bybit.md`
  - `homework/2026-01-24/ETHUSDT-Binance.md`
- Имя биржи указывается с заглавной первой буквы (Binance, Bybit, Coinbase и т.д.)

### Структура содержимого файла

**Для акций и других инструментов:**
```markdown
# {SYMBOL} - {DATE}
```

**Для криптовалют:**
```markdown
# {SYMBOL} ({EXCHANGE}) - {DATE}
```

Примеры:
- `# BTCUSDT (Binance) - 2026-01-24`
- `# ETHUSDT (Bybit) - 2026-01-24`

**ВАЖНО:** Для криптовалют имя биржи должно быть указано:
1. В имени файла: `SYMBOL-EXCHANGE.md`
2. В заголовке внутри файла: `# SYMBOL (EXCHANGE) - DATE`

Это позволяет различать анализ одной и той же криптовалютной пары на разных биржах, так как цены и объемы могут отличаться.

**Полная структура файла:**

```markdown
# {SYMBOL} ({EXCHANGE}) - {DATE}

## Текущая ситуация
- Цена: {price}
- Изменение: {change}%
- Объём: {volume} (vs avg: {volume_vs_avg})
- ATR(5): {atr} (расчетный, без паранормальных баров, см. @trends)

## График

![График {SYMBOL}](./{SYMBOL}.png)

## Тренды и фазы рынка (см. @trends)
- **Глобальный тренд (W1/MN):** {global_trend} (восходящий/нисходящий/боковой)
- **Локальный тренд (D1/H1):** {local_trend} (восходящий/нисходящий/боковой)
- **Синхронизация:** {sync_status} (синхронизированы/противоречат)
- **Сила тренда:** {trend_strength} (сильный/средний/слабый)
  - Ценовое действие: {price_action}
  - Объемы: {volume_analysis}
  - ATR: {atr_analysis}
- **Фаза рынка:** {market_phase} (накопление/импульс/коррекция/ретест/флэт/истощение)

## Уровни

| Цена | Тип уровня | Тип | Сила | Касания | Подтверждение | Комментарий |
|------|------------|-----|------|---------|---------------|-------------|
| ... | Сопротивление/Поддержка | ... | ... | ... | ... | ... |

*Таблица отсортирована по цене сверху вниз (от максимальной к минимальной). Включены только 5-10 самых сильных уровней.*

## Предпосылки
[чеклист, включая проверку корреляции]

## Корреляция с индексами
- **Основной индекс**: {main_index} (S&P 500 / NASDAQ / Dow Jones)
- **Корреляция**: {correlation_status} (низкая / средняя / высокая)
- **Анализ**: {correlation_analysis}
  - Инструмент имеет "собственную жизнь": {yes/no}
  - Синхронность индексов: {synchronized/divergence}
  - Состояние рынка: {market_state}
- **Решение**: {correlation_decision} (соответствует направлению сделки / противоречит)

## Торговый сценарий (см. @trends)

**Направление**: Long/Short (на основе глобального тренда: {global_trend})

**Триггер**: ... (что должно произойти для входа)

**Вход**: ... (максимально близко к уровню - принцип близости)

**Стоп-лосс**: 
  - Технический стоп: ... (за уровнем {level_price})
  - Расчетный стоп (ATR): ... (20-30% от ATR(5) = {calculated_stop})
  - **Выбранный стоп**: ... (технический/расчетный, риск: ...%)

**Тейк-профит**: ... (R:R минимум 2:1)

## Рекомендация
[решение и причина]
```

## Важные правила

1. **Никогда не торгуй без домашнего задания**
2. **Всегда расписывай сценарий до начала сессии** (эмоции не должны влиять)
3. **Стоп-лосс обязателен** для каждой сделки
4. **Минимум 2:1 R:R** — иначе не торговать
5. **Максимум 1% риска** на сделку
