# Руководство по использованию Trading Agent

## Быстрый старт

### 1. Настройка workspace

```bash
cd trading-workspace
ln -s ../trading-agent-cursor/.cursor/rules .cursor/rules
ln -s ../trading-agent-cursor/.claude .claude
```

### 2. Проверка MCP серверов

Убедитесь, что `mcp.json` настроен правильно и MCP серверы доступны.

### 3. Открытие в Claude Code/OpenCode/Cursor

Откройте `trading-workspace` в редакторе с поддержкой MCP.

## Примеры использования

### Домашнее задание (утром, до открытия рынка)

При запросе на скрининг автоматически применяется skill `screening`, который использует критерии методологии Герчика для фильтрации инструментов.

```
Пользователь: Проведи скрининг для интрадея

Агент: [Автоматически применяет skill screening:
        - Получает данные через MCP (котировки, история, статистика)
        - Проверяет критерии (объем, ATR, цена, тренд)
        - Применяет правило 95% (отбирает только 5% с "супер понятной картинкой")
        - Проверяет корреляцию с индексами (для акций)
        - Возвращает таблицу с результатами скрининга]

Пользователь: Проанализируй AAPL

Агент: [Анализирует AAPL: уровни, предпосылки, формирует сценарий]

Пользователь: Добавь AAPL на лонг-лист

Агент: [Создаёт файл в watchlist/YYYY-MM-DD/longs.md]
```

### Торговая сессия

```
Пользователь: Покажи мой лист на сегодня

Агент: [Читает watchlist/YYYY-MM-DD/, выводит список]

Пользователь: Проверь условия для входа в AAPL

Агент: [Получает текущую цену через MCP, сравнивает с триггером,
        сообщает о готовности к входу]
```

### Запись сделки

```
Пользователь: Запиши сделку: AAPL Long, вход 185.62 @ 10:45, 
              выход 186.80 @ 14:20, P/L +$118

Агент: [Добавляет запись в journal/YYYY-MM/YYYY-MM-DD.md и 
        journal/YYYY-MM/trades.jsonl]
```

### Анализ статистики

```
Пользователь: Покажи статистику за январь

Агент: [Анализирует journal/2026-01/, выводит метрики:
        - Win rate
        - Средний P/L
        - Общий P/L
        - Анализ ошибок]
```

## Использование Skills

Skills автоматически применяются агентом при обнаружении соответствующих запросов. Они содержат структурированные инструкции для выполнения специфических задач.

### Skill: Screening (Скрининг инструментов)

Skill `screening` автоматически активируется при запросах на поиск торговых инструментов. Он применяет строгие критерии методологии Герчика для фильтрации инструментов.

#### Триггеры для активации

Skill автоматически применяется при следующих запросах:
- "Проведи скрининг акций"
- "Найди криптовалюты для торговли"
- "Скрининг форекс пар"
- "Проведи скрининг для интрадея"
- "Найди инструменты для торговли"
- Любые запросы со словами "скрининг", "screening", "find instruments", "trading candidates"

#### Процесс работы skill

1. **Получение данных**: Использует MCP tools для получения:
   - Текущих котировок (`get_real_time_quote`)
   - Исторических данных (`get_stock_history`, `get_crypto_history`)
   - Рыночной статистики (`get_market_stats`)

2. **Проверка базовых критериев**:
   - Для акций: объем >300k/500k, ATR >$1, цена >$0.50, только США
   - Для крипто: ликвидность >$1M, объем 50-100M (зависит от риска)
   - Для форекс: коэффициент ликвидности >4 (>5 идеально)

3. **Анализ трендов**: Использует правило `@trends` для определения:
   - Глобального тренда (W1/MN)
   - Локального тренда (D1/H1)
   - Силы тренда
   - Фазы рынка

4. **Применение правила 95%**: Строго отклоняет 95% инструментов, оставляя только 5% с "супер понятной картинкой"

5. **Проверка корреляции**: Для акций проверяет корреляцию с индексами (S&P 500, NASDAQ)

6. **Фильтрация**: Исключает "зараженные зоны", глубокие ложные пробои, "пилу"

#### Формат результатов

Skill возвращает результаты в виде структурированной таблицы:

```markdown
# Скрининг инструментов - 2026-01-26

## Критерии
- **Акции**: Average Volume > 300k (стандарт) / > 500k (высокая ликвидность), ATR > $1, цена >$0.50, только США
- **Криптовалюты**: Ликвидность > $1M, объём > 50-100M (в зависимости от риска)
- **Forex**: Коэффициент ликвидности > 4 (идеально > 5)
- **Правило 95%**: Торговать только 5% с "супер понятной картинкой"

## Результаты

| Символ | Цена | Avg Volume | ATR | Изменение | Глоб. тренд | Лок. тренд | Сила | Фаза | Корреляция | Статус |
|--------|------|------------|-----|-----------|-------------|------------|------|------|------------|--------|
| AAPL   | $185.50 | 65M (>500k ✅) | $2.10 (>$1 ✅) | +1.2% | Up (W1) | Up (D1) | Сильный | Импульс | Низкая | ✅     |
```

#### Примеры использования

**Скрининг акций:**
```
Пользователь: Проведи скрининг акций США

Агент: [Применяет skill screening, проверяет критерии для акций,
        возвращает таблицу с кандидатами, прошедшими все фильтры]
```

**Скрининг криптовалют:**
```
Пользователь: Найди криптовалюты с объемом >100M для торговли

Агент: [Применяет skill screening с фокусом на криптовалюты,
        проверяет ликвидность и объем согласно порогам риска,
        возвращает список подходящих пар]
```

**Скрининг форекс:**
```
Пользователь: Скрининг форекс пар с коэффициентом ликвидности >5

Агент: [Применяет skill screening для форекс,
        рассчитывает коэффициент ликвидности для каждой пары,
        фильтрует по порогу >5, возвращает список активных пар]
```

**Скрининг с фильтрами:**
```
Пользователь: Проведи скрининг акций с объемом >500k и ATR >$2

Агент: [Применяет skill screening с дополнительными фильтрами,
        использует строгие критерии высокой ликвидности,
        возвращает только инструменты, соответствующие всем условиям]
```

#### Важные замечания

- Skill строго следует правилу "95%" - большинство инструментов будет отклонено
- Торгуются только инструменты с "супер понятной картинкой"
- Для акций обязательно проверяется корреляция с индексами
- Исключаются инструменты во флэте в середине диапазона
- Результаты ограничены 10-20 кандидатами (или меньше при строгой фильтрации)

## Работа с методологией

### Вопросы по методологии

```
Пользователь: Что говорит Герчик о работе с уровнями?

Агент: [Запрашивает информацию из knowledge base через RAG,
        возвращает релевантные фрагменты с цитатами]
```

### Проверка соответствия методологии

```
Пользователь: Соответствует ли мой сценарий по AAPL методологии Герчика?

Агент: [Проверяет сценарий по критериям из knowledge base,
        указывает на соответствие или несоответствие]
```

## Структура данных

### Watchlist

Файлы создаются автоматически при добавлении инструментов:
- `watchlist/YYYY-MM-DD/longs.md` - инструменты для покупки
- `watchlist/YYYY-MM-DD/shorts.md` - инструменты для продажи

### Homework

Файлы анализа инструментов:
- `homework/YYYY-MM-DD/SYMBOL.md` - полный анализ инструмента

### Journal

Журнал сделок:
- `journal/YYYY-MM/YYYY-MM-DD.md` - markdown журнал дня
- `journal/YYYY-MM/trades.jsonl` - структурированные данные для анализа

## Важные напоминания

1. **Всегда выполняйте домашнее задание** перед торговлей
2. **Следуйте плану** - не меняйте SL/TP во время сделки
3. **Ведите статистику** - записывайте все сделки
4. **Анализируйте результаты** - учитесь на ошибках

## Troubleshooting

### MCP сервер не отвечает

Проверьте:
- Правильность путей в `mcp.json`
- Доступность markethub-mcp сервера
- Логи MCP сервера

### Агент не понимает команды

Убедитесь, что:
- Симлинки на правила созданы правильно
- Файл `.claude/CLAUDE.md` доступен
- MCP серверы подключены

### Данные не сохраняются

Проверьте:
- Права на запись в `trading-workspace`
- Структуру директорий
- Формат данных соответствует схемам
